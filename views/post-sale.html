<!doctype html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pós-venda | Gestão</title>
  <link href="/layout.css" rel="stylesheet" />
  <link href="/styles.css" rel="stylesheet" />
</head>
<body>
<header class="topbar">
  <div class="container" style="display:flex;align-items:center;gap:16px">
    <a class="brand-link" href="/" style="display:flex;align-items:center;gap:8px;color:var(--muted);text-decoration:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      Voltar
    </a>
    <h1 style="margin:0">Pós-venda</h1>
    <div class="top-actions" style="margin-left:auto;display:flex;gap:8px">
      <span id="top-actions-unauthed"><button class="btn primary" id="loginBtn">Entrar</button></span>
      <span id="top-actions-authed" hidden>
        <button class="btn" id="refreshBtn">Renovar token</button>
        <form method="post" action="/logout" style="display:inline"><button class="btn" type="submit">Sair</button></form>
      </span>
    </div>
  </div>
</header>

<div class="container ps-shell" style="margin-top:16px">
  <!-- ESQUERDA: fila -->
  <aside class="ps-list">
    <div class="panel">
      <div class="panel-header"><h2>Fila de pós-venda</h2></div>
      <div class="panel-body row">
        <input id="q" class="input grow" placeholder="Pesquisar por título/pack/order…" />
        <select id="fltStatus" class="input">
          <option value="all">Todas</option>
          <option value="unread">Pendentes</option>
          <option value="active">Ativas</option>
          <option value="blocked">Bloqueadas</option>
        </select>
      </div>
      <div class="panel-body row tiny muted2">
        <div id="summary">–</div>
        <button class="btn" id="syncOrdersBtn" style="margin-left:auto">Sincronizar pedidos (30d)</button>
      </div>
      <div class="panel-body packs" id="packs"></div>
    </div>
  </aside>

  <!-- CENTRO: chat -->
  <main>
    <div class="panel">
      <div class="panel-header">
        <h2>Conversa</h2>
        <div class="panel-actions">
          <!-- Toggle moderno -->
          <label class="switch">
            <input id="markAsRead" type="checkbox" checked />
            <span class="slider"></span>
            <span class="lbl">Marcar como lidas ao abrir</span>
          </label>
        </div>
      </div>

      <div class="panel-body">
        <div class="row tiny muted2">
          <div id="convHead" class="grow">Selecione um pack/ordem…</div>
          <div id="convState"></div>
        </div>

        <!-- Thread -->
        <div class="thread" id="thread"></div>

        <!-- Composer -->
        <div class="composer">
          <!-- Motivo (Action Guide) -->
          <select id="guideOption" class="input" style="min-width:220px">
            <option value="">– Motivo (Action Guide) –</option>
          </select>

          <!-- Ícone de anexo + input oculto -->
          <button class="icon-btn" id="attachBtn" title="Anexar">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l10.6-10.6a4 4 0 015.66 5.66L9.88 17.95a2 2 0 01-2.83-2.83l8.49-8.49"/>
            </svg>
          </button>
          <input id="attachInput" type="file" multiple hidden />

          <!-- Mensagem -->
          <textarea id="msgText" class="input" maxlength="350" placeholder="Escreva ao comprador…"></textarea>

          <!-- Enviar -->
          <button class="btn primary" id="sendBtn">Enviar</button>
        </div>

        <!-- Chips + contador -->
        <div id="charRow" class="tiny muted2">
          <div id="chips"></div>
          <div class="grow"></div>
          <div>Caps: <span id="capAvail">–</span> • <span id="charCount">0/350</span>.</div>
        </div>

        <div id="blockedHint" class="blocked tiny" hidden></div>
      </div>
    </div>
  </main>

  <!-- DIREITA: detalhes do pedido/itens -->
  <aside class="details">
    <div class="panel">
      <div class="panel-header"><h2>Detalhes do pedido</h2></div>
      <div class="panel-body" id="details">
        <div class="muted">Selecione um pack para ver os itens.</div>
      </div>
    </div>
  </aside>
</div>

<div id="toast"></div>
<script type="module" src="/post_sale.js"></script>
</body>
</html>
