<!doctype html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <title>Mercado Livre | Integra√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="/layout.css" rel="stylesheet" />
  <link href="/styles.css" rel="stylesheet" />
  <style>
    /* ajustes de alinhamento do topo */
    .topbar .container{display:flex;align-items:center;gap:16px}
    .topbar .brand{display:flex;align-items:center;gap:12px}
    .topbar .top-actions{margin-left:auto;display:flex;align-items:center;gap:8px}
    .panel-header{display:flex;align-items:center;justify-content:space-between}
    .panel-header .panel-actions{margin-left:auto}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container"><!-- NOVO wrapper -->
      <div class="brand">
        <div class="logo">üí¨</div>
        <div>
          <div>Mercado Livre</div>
          <div class="muted">Mensagens & P√≥s-venda</div>
        </div>
      </div>

      <div class="top-actions">
        <span id="top-actions-unauthed">
          <button class="btn primary" id="loginBtn">Entrar</button>
        </span>
        <span id="top-actions-authed" hidden>
          <button class="btn" id="refreshBtn">Renovar token</button>
          <form method="post" action="/logout"><button class="btn" type="submit">Sair</button></form>
        </span>
      </div>
    </div>
  </header>

  <div class="container main-layout">
    <aside class="side">
      <h3>Navega√ß√£o</h3>
      <nav class="nav">
        <a href="#sec-auth">üîê Autentica√ß√£o</a>
        <a href="/post-sale">üì¨ P√≥s-venda</a><!-- NOVO -->
        <a href="/ads">üìà An√∫ncios</a>
        <a href="/orders">üßæ Pedidos</a>
      </nav>
      <div id="userChip" class="chip-status"><span class="dot warn"></span> n√£o autenticado</div>
    </aside>

    <main class="content">
      <!-- Destaque para nova tela unificada -->
      <section class="panel" id="sec-postsale-feature">
        <div class="panel-header">
          <h2>P√≥s-venda unificado</h2>
          <div class="panel-actions">
            <a class="btn primary" href="/post-sale">Abrir P√≥s-venda</a>
          </div>
        </div>
        <div class="panel-body">
          <p class="muted">Reunimos <em>Pendentes</em>, <em>Conversas</em>, <em>Enviar Mensagem</em> e <em>Upload de Anexos</em> em uma √∫nica tela.</p>
        </div>
      </section>

      <!-- Autentica√ß√£o & Status (mantido na Home) -->
      <section class="panel" id="sec-auth">
        <div class="panel-header"><h2>Autentica√ß√£o &amp; Status</h2></div>
        <div id="auth-success-message" class="auth-status-banner" hidden role="status" aria-live="polite" aria-atomic="true"></div>
        <div class="panel-body grid">
          <div class="col-6 field">
            <label>Resposta da API (JSON)</label>
            <pre class="json" id="statusOut" role="status" aria-live="polite" aria-atomic="true">{ carregando... }</pre>
          </div>
          <div class="col-6 field">
            <label>A√ß√µes</label>
            <div id="auth-actions-unauthed" class="actions-group">
              <button class="btn primary" id="loginBtn2">Iniciar login</button>
              <button class="btn" id="pasteBtn2">Colar code/state</button>
            </div>
            <div id="auth-actions-authed" class="actions-group" hidden>
              <button class="btn" id="refreshBtn2">Renovar token</button>
              <button class="btn" id="statusBtn">Atualizar status</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== Blocos antigos: agora ocultos (foram movidos para /post-sale) ===== -->
      <section class="panel" id="sec-unread" hidden>
        <div class="panel-header"><h2>Consultar Mensagens Pendentes</h2></div>
        <div class="panel-body grid">
          <div class="col-4 field">
            <label for="role">Seu papel (Role)</label>
            <select id="role" class="input">
              <option value="seller">Vendedor (seller)</option>
              <option value="buyer">Comprador (buyer)</option>
            </select>
          </div>
          <div class="col-8 field-action">
            <button class="btn" id="unreadBtn">Consultar</button>
          </div>
          <div class="col-12 field">
            <label>Resposta da API</label>
            <pre class="json" id="unreadOut"></pre>
          </div>
        </div>
      </section>

      <section class="panel" id="sec-pack" hidden>
        <div class="panel-header"><h2>Listar Mensagens de uma Conversa</h2></div>
        <div class="panel-body grid">
          <div class="col-6 field">
            <label for="packId">Pack ID</label>
            <input id="packId" class="input" placeholder="Ex: 200000..." />
          </div>
          <div class="col-3 field">
            <label for="limit">Limite</label>
            <input id="limit" type="number" class="input" value="10" />
          </div>
          <div class="col-3 field">
            <label for="offset">Offset</label>
            <input id="offset" type="number" class="input" value="0" />
          </div>
          <div class="col-12 actions-group space-between">
            <label class="check-label"><input id="markRead" type="checkbox" checked /> Marcar como lidas</label>
            <button class="btn" id="packBtn">Listar mensagens</button>
          </div>
          <div class="col-12 field">
            <label>Resposta da API</label>
            <pre class="json" id="packOut"></pre>
          </div>
        </div>
      </section>

      <section class="panel" id="sec-send" hidden>
        <div class="panel-header"><h2>Enviar Mensagem P√≥s-venda</h2></div>
        <div class="panel-body grid">
          <div class="col-6 field">
            <label for="send_packId">Pack ID</label>
            <input id="send_packId" class="input" />
          </div>
          <div class="col-6 field">
            <label for="to_user_id">ID do Destinat√°rio</label>
            <input id="to_user_id" class="input" />
          </div>
          <div class="col-12 field">
            <label for="msg_text">Texto (at√© 350 caracteres)</label>
            <textarea id="msg_text" class="input" maxlength="350"></textarea>
          </div>
          <div class="col-12 field">
            <label for="attach_ids">IDs dos Anexos (separados por v√≠rgula)</label>
            <input id="attach_ids" class="input" />
          </div>
        </div>
        <div class="panel-footer">
          <button class="btn primary" id="sendBtn">Enviar Mensagem</button>
        </div>
        <div class="panel-body no-padding-top">
          <pre class="json" id="sendOut"></pre>
        </div>
      </section>

      <section class="panel" id="sec-attach" hidden>
        <div class="panel-header"><h2>Upload de Anexos</h2></div>
        <div class="panel-body grid">
          <div class="col-8 field">
            <label for="file">Arquivo (JPG/PNG/PDF/TXT, at√© 25 MB)</label>
            <input type="file" id="file" class="input" />
          </div>
          <div class="col-4 field-action">
            <button class="btn" id="uploadBtn">Fazer Upload</button>
          </div>
          <div class="col-12 field">
            <label>Resposta do Upload</label>
            <pre class="json" id="attachOut"></pre>
          </div>
        </div>
      </section>
      <!-- ===== /blocos antigos ===== -->
    </main>
  </div>

  <div id="toast"></div>
  <script src="/app.js" defer></script>
  <script src="/home.js" defer></script>
</body>
</html>
